/**\n * 下载设置管理\n * 用于管理下载相关的配置，包括下载路径、并发数、超时时间等\n */\n\nconst DownloadSettings = {\n    // 默认设置\n    defaults: {\n        downloadPath: 'Downloads',      // 下载路径（浏览器会使用默认下载目录）\n        maxConcurrent: 5,               // 最大并发下载数\n        timeout: 30000,                 // 单个片段超时时间（毫秒）\n        retryCount: 3,                  // 失败重试次数\n        autoRename: true,               // 自动重命名重复文件\n        showProgress: true,             // 显示下载进度\n    },\n\n    /**\n     * 获取所有设置\n     */\n    getAll() {\n        const stored = localStorage.getItem('downloadSettings');\n        if (stored) {\n            try {\n                return JSON.parse(stored);\n            } catch (e) {\n                console.error('Failed to parse download settings:', e);\n                return this.defaults;\n            }\n        }\n        return this.defaults;\n    },\n\n    /**\n     * 获取单个设置\n     */\n    get(key) {\n        const settings = this.getAll();\n        return settings[key] !== undefined ? settings[key] : this.defaults[key];\n    },\n\n    /**\n     * 设置单个配置\n     */\n    set(key, value) {\n        const settings = this.getAll();\n        settings[key] = value;\n        localStorage.setItem('downloadSettings', JSON.stringify(settings));\n        \n        // 触发设置变更事件\n        window.dispatchEvent(new CustomEvent('downloadSettingsChanged', {\n            detail: { key, value, settings }\n        }));\n    },\n\n    /**\n     * 批量设置\n     */\n    setMultiple(updates) {\n        const settings = this.getAll();\n        Object.assign(settings, updates);\n        localStorage.setItem('downloadSettings', JSON.stringify(settings));\n        \n        // 触发设置变更事件\n        window.dispatchEvent(new CustomEvent('downloadSettingsChanged', {\n            detail: { updates, settings }\n        }));\n    },\n\n    /**\n     * 重置为默认设置\n     */\n    reset() {\n        localStorage.removeItem('downloadSettings');\n        window.dispatchEvent(new CustomEvent('downloadSettingsChanged', {\n            detail: { action: 'reset', settings: this.defaults }\n        }));\n    },\n\n    /**\n     * 验证设置值\n     */\n    validate(key, value) {\n        switch (key) {\n            case 'maxConcurrent':\n                return typeof value === 'number' && value >= 1 && value <= 50;\n            case 'timeout':\n                return typeof value === 'number' && value >= 5000 && value <= 300000;\n            case 'retryCount':\n                return typeof value === 'number' && value >= 0 && value <= 10;\n            case 'autoRename':\n            case 'showProgress':\n                return typeof value === 'boolean';\n            case 'downloadPath':\n                return typeof value === 'string' && value.length > 0;\n            default:\n                return true;\n        }\n    },\n\n    /**\n     * 获取M3U8下载器配置\n     */\n    getM3U8Config() {\n        return {\n            maxConcurrent: this.get('maxConcurrent'),\n            timeout: this.get('timeout'),\n            retryCount: this.get('retryCount'),\n        };\n    },\n};\n\n// 导出为全局对象\nwindow.DownloadSettings = DownloadSettings;\n"
