/**\n * 下载设置UI\n * 提供下载设置的用户界面\n */\n\nconst DownloadSettingsUI = {\n    /**\n     * 创建设置对话框\n     */\n    createSettingsModal() {\n        const html = `\n        <div id=\"downloadSettingsModal\" class=\"fixed inset-0 bg-black/95 hidden flex items-center justify-center z-[10003]\">\n            <div class=\"bg-[#111] p-8 rounded-lg w-11/12 max-w-md border border-[#333] flex flex-col max-h-[90vh] overflow-y-auto\">\n                <div class=\"flex justify-between items-center mb-6 flex-none\">\n                    <h2 class=\"text-2xl font-bold gradient-text\">下载设置</h2>\n                    <button onclick=\"document.getElementById('downloadSettingsModal').classList.add('hidden')\" class=\"text-gray-400 hover:text-white text-2xl\">&times;</button>\n                </div>\n                \n                <div class=\"space-y-6 flex-1\">\n                    <!-- 最大并发数 -->\n                    <div>\n                        <label class=\"text-gray-300 text-sm font-medium mb-2 block\">\n                            最大并发下载数\n                        </label>\n                        <div class=\"flex items-center gap-2\">\n                            <input type=\"range\" id=\"maxConcurrentSlider\" min=\"1\" max=\"20\" value=\"5\" \n                                   class=\"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer\" />\n                            <span id=\"maxConcurrentValue\" class=\"text-gray-400 text-sm min-w-[40px] text-right\">5</span>\n                        </div>\n                        <p class=\"text-gray-500 text-xs mt-1\">更多并发 = 更快速度，但可能增加服务器负载</p>\n                    </div>\n                    \n                    <!-- 超时时间 -->\n                    <div>\n                        <label class=\"text-gray-300 text-sm font-medium mb-2 block\">\n                            单片段超时时间（秒）\n                        </label>\n                        <div class=\"flex items-center gap-2\">\n                            <input type=\"range\" id=\"timeoutSlider\" min=\"5\" max=\"300\" step=\"5\" value=\"30\" \n                                   class=\"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer\" />\n                            <span id=\"timeoutValue\" class=\"text-gray-400 text-sm min-w-[50px] text-right\">30s</span>\n                        </div>\n                        <p class=\"text-gray-500 text-xs mt-1\">网络差时可增加此值</p>\n                    </div>\n                    \n                    <!-- 重试次数 -->\n                    <div>\n                        <label class=\"text-gray-300 text-sm font-medium mb-2 block\">\n                            失败重试次数\n                        </label>\n                        <div class=\"flex items-center gap-2\">\n                            <input type=\"range\" id=\"retryCountSlider\" min=\"0\" max=\"10\" value=\"3\" \n                                   class=\"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer\" />\n                            <span id=\"retryCountValue\" class=\"text-gray-400 text-sm min-w-[30px] text-right\">3</span>\n                        </div>\n                        <p class=\"text-gray-500 text-xs mt-1\">下载失败时的重试次数</p>\n                    </div>\n                    \n                    <!-- 自动重命名 -->\n                    <div>\n                        <label class=\"text-gray-300 text-sm font-medium mb-2 flex items-center\">\n                            <input type=\"checkbox\" id=\"autoRenameCheckbox\" checked \n                                   class=\"mr-2 w-4 h-4 cursor-pointer\" />\n                            <span>自动重命名重复文件</span>\n                        </label>\n                        <p class=\"text-gray-500 text-xs mt-1\">如果文件已存在，自动添加后缀</p>\n                    </div>\n                    \n                    <!-- 显示进度 -->\n                    <div>\n                        <label class=\"text-gray-300 text-sm font-medium mb-2 flex items-center\">\n                            <input type=\"checkbox\" id=\"showProgressCheckbox\" checked \n                                   class=\"mr-2 w-4 h-4 cursor-pointer\" />\n                            <span>显示下载进度</span>\n                        </label>\n                        <p class=\"text-gray-500 text-xs mt-1\">下载时显示进度条和状态信息</p>\n                    </div>\n                </div>\n                \n                <div class=\"flex gap-2 mt-6 flex-none\">\n                    <button onclick=\"DownloadSettingsUI.resetSettings()\" \n                            class=\"flex-1 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors\">\n                        重置为默认\n                    </button>\n                    <button onclick=\"DownloadSettingsUI.saveSettings()\" \n                            class=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors\">\n                        保存设置\n                    </button>\n                </div>\n            </div>\n        </div>\n        `;\n        return html;\n    },\n\n    /**\n     * 初始化设置UI\n     */\n    init() {\n        // 检查是否已经创建了modal\n        if (document.getElementById('downloadSettingsModal')) {\n            return;\n        }\n\n        // 创建modal\n        const modal = document.createElement('div');\n        modal.innerHTML = this.createSettingsModal();\n        document.body.appendChild(modal);\n\n        // 绑定事件\n        this.bindEvents();\n        this.loadSettings();\n    },\n\n    /**\n     * 绑定事件\n     */\n    bindEvents() {\n        // 最大并发数\n        const maxConcurrentSlider = document.getElementById('maxConcurrentSlider');\n        const maxConcurrentValue = document.getElementById('maxConcurrentValue');\n        if (maxConcurrentSlider) {\n            maxConcurrentSlider.addEventListener('input', (e) => {\n                maxConcurrentValue.textContent = e.target.value;\n            });\n        }\n\n        // 超时时间\n        const timeoutSlider = document.getElementById('timeoutSlider');\n        const timeoutValue = document.getElementById('timeoutValue');\n        if (timeoutSlider) {\n            timeoutSlider.addEventListener('input', (e) => {\n                timeoutValue.textContent = (e.target.value / 10) + 's';\n            });\n        }\n\n        // 重试次数\n        const retryCountSlider = document.getElementById('retryCountSlider');\n        const retryCountValue = document.getElementById('retryCountValue');\n        if (retryCountSlider) {\n            retryCountSlider.addEventListener('input', (e) => {\n                retryCountValue.textContent = e.target.value;\n            });\n        }\n    },\n\n    /**\n     * 加载设置到UI\n     */\n    loadSettings() {\n        if (!window.DownloadSettings) return;\n\n        const settings = window.DownloadSettings.getAll();\n\n        // 最大并发数\n        const maxConcurrentSlider = document.getElementById('maxConcurrentSlider');\n        const maxConcurrentValue = document.getElementById('maxConcurrentValue');\n        if (maxConcurrentSlider) {\n            maxConcurrentSlider.value = settings.maxConcurrent;\n            maxConcurrentValue.textContent = settings.maxConcurrent;\n        }\n\n        // 超时时间\n        const timeoutSlider = document.getElementById('timeoutSlider');\n        const timeoutValue = document.getElementById('timeoutValue');\n        if (timeoutSlider) {\n            const timeoutSeconds = settings.timeout / 1000;\n            timeoutSlider.value = timeoutSeconds;\n            timeoutValue.textContent = timeoutSeconds + 's';\n        }\n\n        // 重试次数\n        const retryCountSlider = document.getElementById('retryCountSlider');\n        const retryCountValue = document.getElementById('retryCountValue');\n        if (retryCountSlider) {\n            retryCountSlider.value = settings.retryCount;\n            retryCountValue.textContent = settings.retryCount;\n        }\n\n        // 自动重命名\n        const autoRenameCheckbox = document.getElementById('autoRenameCheckbox');\n        if (autoRenameCheckbox) {\n            autoRenameCheckbox.checked = settings.autoRename;\n        }\n\n        // 显示进度\n        const showProgressCheckbox = document.getElementById('showProgressCheckbox');\n        if (showProgressCheckbox) {\n            showProgressCheckbox.checked = settings.showProgress;\n        }\n    },\n\n    /**\n     * 保存设置\n     */\n    saveSettings() {\n        if (!window.DownloadSettings) return;\n\n        const maxConcurrent = parseInt(document.getElementById('maxConcurrentSlider')?.value || 5);\n        const timeout = parseInt(document.getElementById('timeoutSlider')?.value || 30) * 1000;\n        const retryCount = parseInt(document.getElementById('retryCountSlider')?.value || 3);\n        const autoRename = document.getElementById('autoRenameCheckbox')?.checked || true;\n        const showProgress = document.getElementById('showProgressCheckbox')?.checked || true;\n\n        window.DownloadSettings.setMultiple({\n            maxConcurrent,\n            timeout,\n            retryCount,\n            autoRename,\n            showProgress,\n        });\n\n        // 关闭对话框\n        document.getElementById('downloadSettingsModal')?.classList.add('hidden');\n        showToast('下载设置已保存', 'success');\n    },\n\n    /**\n     * 重置为默认设置\n     */\n    resetSettings() {\n        if (confirm('确定要重置为默认设置吗？')) {\n            window.DownloadSettings?.reset();\n            this.loadSettings();\n            showToast('已重置为默认设置', 'success');\n        }\n    },\n\n    /**\n     * 显示设置对话框\n     */\n    show() {\n        const modal = document.getElementById('downloadSettingsModal');\n        if (!modal) {\n            this.init();\n        }\n        document.getElementById('downloadSettingsModal')?.classList.remove('hidden');\n        this.loadSettings();\n    },\n\n    /**\n     * 隐藏设置对话框\n     */\n    hide() {\n        document.getElementById('downloadSettingsModal')?.classList.add('hidden');\n    },\n};\n\n// 导出为全局对象\nwindow.DownloadSettingsUI = DownloadSettingsUI;\n\n// 页面加载完成后初始化\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n        DownloadSettingsUI.init();\n    });\n} else {\n    DownloadSettingsUI.init();\n}\n"
