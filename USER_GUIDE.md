# LibreTV 下载功能使用指南

## 快速开始

### 1. 单集下载

这是最简单的下载方式，适合下载单个视频。

**步骤**：
1. 打开播放器页面，选择想要观看的视频
2. 点击播放器控制栏中的下载按钮（向下箭头图标）
3. 视频会自动添加到下载队列
4. 下载管理器会自动弹出，显示下载进度
5. 下载完成后，文件会保存到您选择的目录或浏览器默认下载目录

**文件命名规则**：
- 格式：`视频标题 - 第X集.mp4`
- 例如：`庆余年 - 第1集.mp4`

### 2. 批量下载

适合下载连续剧的多集内容。

**步骤**：
1. 在播放器页面，点击"批量下载"按钮（文件列表图标）
2. 页面进入批量选择模式，集数按钮会变成可选择状态
3. 点击想要下载的集数进行选择（已选择的会显示蓝色背景和勾选标记）
4. 使用快捷操作：
   - **全选**：选择所有集数
   - **取消全选**：清除所有选择
   - **选择范围**：输入起始和结束集数，快速选择一个范围
5. 确认选择后，点击"开始下载"
6. 所有选中的集数会依次加入下载队列
7. 点击"取消"退出批量模式

**提示**：
- 批量下载会自动排队，不会同时下载所有集数
- 默认最多同时下载 3 个任务，其余任务会自动排队等待

### 3. 下载管理器

下载管理器是一个独立的后台面板，不会占用主页面。

**打开方式**：
- 点击右下角的浮动下载按钮（带有下载图标的圆形按钮）
- 或在添加下载任务时自动弹出

**功能**：
- **查看进度**：实时显示每个任务的下载进度
- **暂停任务**：点击"暂停"可以暂停正在下载的任务
- **重试任务**：对于失败的任务，点击"重试"重新下载
- **删除任务**：点击"删除"移除任务（不会删除已下载的文件）
- **清除已完成**：一键清除所有已完成的任务记录
- **折叠/展开**：点击标题栏的箭头图标可以折叠面板
- **关闭面板**：点击 X 关闭面板，下载会继续在后台进行

**任务状态说明**：
- 🟡 **等待中**：任务在队列中等待
- 🔵 **下载中**：正在下载
- 🟢 **已完成**：下载成功
- 🔴 **失败**：下载失败（可以重试）
- ⚪ **已暂停**：任务被暂停

### 4. 下载设置

自定义下载参数和保存路径。

**打开方式**：
点击播放器控制栏中的"下载设置"按钮（齿轮图标）

**可配置选项**：

#### 最大并发下载数（1-20）
- 默认值：5
- 说明：同时下载的视频片段数量
- 建议：网络好时可以设置为 10-15，网络差时设置为 3-5

#### 单片段超时时间（5-300秒）
- 默认值：30秒
- 说明：每个视频片段的下载超时时间
- 建议：网络不稳定时可以增加到 60 秒或更高

#### 失败重试次数（0-10次）
- 默认值：3次
- 说明：片段下载失败后的重试次数
- 建议：网络不稳定时可以增加到 5 次

#### 自动重命名重复文件
- 默认值：开启
- 说明：如果文件名已存在，自动添加数字后缀
- 例如：`视频.mp4` → `视频(1).mp4`

#### 显示下载进度
- 默认值：开启
- 说明：下载时显示进度条和状态信息

#### 本地下载路径
- 默认值：浏览器默认下载目录
- 说明：自定义视频保存位置
- **使用方法**：
  1. 点击"选择目录"按钮
  2. 在弹出的文件选择器中选择文件夹
  3. 授权浏览器访问该文件夹
  4. 之后所有下载会自动保存到该位置

**注意事项**：
- 自定义路径功能需要 Chrome/Edge 86+ 浏览器
- Safari 和 Firefox 暂不支持，会使用默认下载目录
- 选择的目录会被记住，下次打开仍然有效

### 5. 下载历史

下载管理器会自动保存下载历史记录（最多 100 条）。

**查看历史**：
打开下载管理器即可看到所有历史任务

**清理历史**：
- 点击"清除已完成"只删除已完成的任务记录
- 或手动删除单个任务

## 常见问题

### Q1: 下载的文件无法播放？
**A**: 下载的文件是 MP4 格式，应该可以在大多数播放器中播放。如果无法播放，请尝试：
- 使用 VLC 播放器
- 使用 PotPlayer（Windows）
- 使用 IINA（macOS）
- 检查文件是否完整下载（查看文件大小）

### Q2: 下载速度很慢？
**A**: 可以尝试：
- 增加"最大并发下载数"到 10-15
- 检查网络连接
- 关闭其他占用带宽的应用

### Q3: 下载经常失败？
**A**: 可以尝试：
- 增加"单片段超时时间"到 60 秒
- 增加"失败重试次数"到 5 次
- 减少"最大并发下载数"到 3
- 检查网络稳定性

### Q4: 如何更改下载位置？
**A**: 
1. 点击下载设置按钮
2. 找到"本地下载路径"选项
3. 点击"选择目录"
4. 选择想要的文件夹
5. 注意：需要 Chrome/Edge 86+ 浏览器

### Q5: 批量下载会不会很慢？
**A**: 不会。批量下载使用队列机制，同时最多下载 3 个任务，既保证速度又不会占用太多资源。

### Q6: 下载管理器关闭后，下载会停止吗？
**A**: 不会。下载会在后台继续进行，你可以：
- 继续浏览网站
- 选择其他视频
- 添加更多下载任务
- 随时打开下载管理器查看进度

### Q7: 可以同时下载多少个视频？
**A**: 默认最多同时下载 3 个完整视频。超过的任务会自动排队等待。每个视频内部会并发下载多个片段（默认 5 个）。

### Q8: 下载的文件保存在哪里？
**A**: 
- 如果设置了自定义路径：保存在您选择的文件夹
- 如果没有设置：保存在浏览器默认下载目录
  - Windows: `C:\Users\用户名\Downloads`
  - macOS: `/Users/用户名/Downloads`
  - Linux: `/home/用户名/Downloads`

## 键盘快捷键

虽然下载功能主要通过鼠标操作，但在批量选择模式下可以使用：

- **Esc**：退出批量下载模式（需要自己实现）
- **Ctrl/Cmd + A**：全选（浏览器默认行为，可能需要自定义）

## 技术支持

如果遇到问题：
1. 查看浏览器控制台（F12）的错误信息
2. 检查浏览器版本是否符合要求
3. 尝试清除浏览器缓存
4. 在 GitHub 提交 Issue

## 隐私说明

- 下载历史仅保存在本地浏览器（localStorage）
- 自定义路径信息保存在 IndexedDB
- 不会上传任何数据到服务器
- 清除浏览器数据会删除所有设置和历史
